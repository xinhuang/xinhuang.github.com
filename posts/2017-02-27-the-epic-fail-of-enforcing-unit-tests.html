<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><title>The Epic Fail of Enforcing Unit Tests</title></head><body><article id=top class=markdown-body><div><div><h1>The Epic Fail of Enforcing Unit Tests</h1><div class=metadata>2017-02-27</div>
                <p><em>The DIRECT TV &quot;Get Rid Of Cable&quot; commercial is a very interesting commercial. If you haven&#39;t watch it yet, you can watch the full commercial <a href="https://www.youtube.com/watch?v=NZ80SVOHKoo">here</a>. It starts by a simple thing, then it leads to complete a different story &quot;<strong>convincingly</strong>&quot; and &quot;<strong>reasonably</strong>&quot;.</em></p>
<p>Here is what will happen when your developers are forced to reach 100% test coverage:</p>
<blockquote>
<p>When developers are forced to write unit tests, they write shit tests which test nothing.</p>
</blockquote>
<blockquote>
<p>When people write shit tests, their tests depend on the implementation.</p>
</blockquote>
<blockquote>
<p>When the tests depend on the implementation, production code is difficult to change.</p>
</blockquote>
<blockquote>
<p>When production code is difficult to change and you change it, you break tests.</p>
</blockquote>
<blockquote>
<p>When you break tests, you fix tests.</p>
</blockquote>
<blockquote>
<p>When you find the tests are shit tests, you want to delete them.</p>
</blockquote>
<blockquote>
<p>If you delete tests, test coverage drops.</p>
</blockquote>
<blockquote>
<p>If test coverage drops, everyone is blaming you.</p>
</blockquote>
<blockquote>
<p>If you cannot delete broken shit tests and have to fix them, you get pissed off.</p>
</blockquote>
<blockquote>
<p>Don&#39;t get pissed off, teach people why and how to write tests from the beginning.</p>
<p>And most importantly, don&#39;t force people to write unit tests.</p>
</blockquote>
<p>You would say: <strong>That is not true. By forcing people writing tests to reach test coverage of N%, (N is usually around 80 hopefully) they will carefully design their code so that it is unit-testable/testable.</strong></p>
<p>Once I had the same belief, until I came across a code snippet looked like below:</p>
<pre class="hljs"><code class="cs">[TestMethod]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DrawGauge_Test</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">using</span> (ShimsContext.Create())
    {
        <span class="hljs-keyword">var</span> privateTestObj = SetupTestObject();
        <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">new</span> PaintEventArgs(g, clipRect);

        privateTestObj.SetField(<span class="hljs-string">"m_pDomainIconIsSmall"</span>, BmpIconSmall)
        DrawGauge();
    }
    <span class="hljs-comment">// If no exception, everything is OK</span>
}</code></pre><p>Let me explain:</p>
<ol>
<li><code>privateTestObj</code> is the SUT (System Under Test).</li>
<li><code>privateTestObj</code> is inherited from a type provided by the SDK. It overrides several methods, and these methods are used only by the <code>DrawGauge()</code>.</li>
<li>By calling <code>DrawGauge()</code> in the test, the override methods are considered &quot;<strong>covered</strong>&quot;.</li>
</ol>
<p>This test brings no value, but only maintenance burden. For a better design, the code should first setting up appropriate condition,  calling the override methods, and asserting correct values are returned (or side effect happened). Calling the <code>DrawGauge()</code> method and assert there is no exception is like cheating. The reason I was tripped over by the test is that I renamed the variable name accessed using reflection, but not because it actually found anything wrong.</p>
<p>Before your developers are ready, please don&#39;t force them to write tests aiming for N% test coverage. Unless they are willing to write tests - usually that is the time stakeholders start to ask questions like &quot;Do we really have to write tests now? Can we do it later? Maybe tomorrow?&quot; (Teach your stakeholders, too!)</p>
<p>For the God&#39;s sake, don&#39;t force people to write unit tests.</p>

                </div></div><hr><a href=/ class=left>Home</a> <a href=# class=right>Top</a></article><style>body{margin:1em auto;max-width:40em;padding:0 .62em;font:1.2em/1.62em sans-serif}h1,h2,h3{line-height:1.2em}@media print{body{max-width:none}}a{text-decoration:none}article{margin:auto;font-size:14px;padding:3px 1em}.metadata{color:rgba(0,0,0,.54)}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}.left{float:left}.right{float:right}</style><link rel=stylesheet href=/github-markdown.css><link rel=stylesheet href=/zenburn.css><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-42274645-1","auto"),ga("send","pageview")</script></body></html>