<!doctype html><html ng-app=xinhuangGithubCom ng-strict-di><head><meta charset=utf-8><title>A Gotcha From auto</title><meta name=description content=""><meta name=viewport content="width=device-width"><!-- Place favicon.ico and apple-touch-icon.png in the root directory --><link rel=stylesheet href=styles/vendor-742ba0962d.css><link rel=stylesheet href=styles/app-d5a71a58a1.css><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-42274645-1', 'auto');
      ga('send', 'pageview');</script></head><body><!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]--><article id=top class=anchor><div layout=row><div flex=30 flex-xs=0 flex-sm=15></div><div flex=40 flex-xs=100 flex-sm=70><h1 class=md-h1>A Gotcha From auto</h1><div class=entry-meta>2014-02-16</div>
            <marked>
                
Recently, I found my random generator doesn&#039;t work. Which is:

    auto engine = mt19937{ random_device()() };
    auto rand = [=](int range) mutable {
        auto idist = uniform_int_distribution&lt;int&gt;(0, range);
        return idist(engine);
    };
    f(rand);

Inside function `f`, it will call `rand` many times and save output to one file. But, generated files are all identical.

Observe closer, I found the declaration of `f` is:

    void f(function&lt;int(int)&gt; f);

Oh, `f` is passed by value. Change to pass by reference:

    void f(const function&lt;int(int)&gt;&amp; f);

Still doesn&#039;t work.

After thought for a while, I found the `lambda object` is implicit converted to `std::function`. Aha! Another copy!

Give a specific type to `rand`:

    function&lt;int(int)&gt; rand = ...;

Problem solved!

            </marked>
            </div></div><md-divider></md-divider><div class=footer layout=row><div flex=30 flex-xs=0 flex-sm=15></div><div flex=40 flex-xs=100 flex-sm=70 layout=row><a href=/ >Home</a><div flex></div><a href=#>Top</a></div></div></article><script src=scripts/vendor-992057851c.js></script><script src=scripts/app-2f307186b4.js></script></body></html>